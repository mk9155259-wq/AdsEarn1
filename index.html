<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AdsEarn Bot</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #f8fafc;
            --primary-gradient: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            --accent-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Layout */
        #app { max-width: 500px; margin: 0 auto; padding: 15px; padding-bottom: 80px; }
        .hidden { display: none !important; }

        /* UI Components */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .balance-card { text-align: center; background: var(--primary-gradient); color: white; }
        .balance-value { font-size: 2.5rem; font-weight: 800; margin: 10px 0; }

        .grid-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-item { background: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 12px; text-align: center; }

        .btn {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary { background: var(--primary-gradient); }
        .btn-secondary { background: #475569; }
        .btn-withdraw { background: var(--accent-color); }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Bottom Nav */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
        }

        .nav-item { color: #94a3b8; text-decoration: none; font-size: 0.8rem; text-align: center; flex: 1; border: none; background: none; }
        .nav-item.active { color: #3b82f6; }

        /* Forms & Inputs */
        input, select {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border: 1px solid #334155;
            background: #0f172a;
            color: white;
        }

        /* Admin Specific */
        .admin-header { background: var(--warning-color); color: black; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-weight: bold; text-align: center; }
        .list-item { background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid #3b82f6; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }
        .badge-pending { background: var(--warning-color); color: black; }
        .badge-approved { background: var(--accent-color); }
        .badge-rejected { background: var(--danger-color); }

        /* Timer Overlay */
        #timer-display { font-size: 1.2rem; font-weight: bold; color: var(--warning-color); margin-top: 10px; }
    </style>
</head>
<body>

<div id="app">
    <div id="view-home" class="view">
        <div class="header">
            <h3>Welcome, <span id="user-name">User</span>!</h3>
            <button class="badge" onclick="showAdminLogin()" style="background:#334155">Admin</button>
        </div>

        <div class="card balance-card">
            <p>Total Earnings</p>
            <div class="balance-value"><span id="user-coins">0</span> ü™ô</div>
            <p>1 Coin = Admin Set Rate</p>
        </div>

        <div class="grid-stats card">
            <div class="stat-item">
                <small>Daily Limit</small>
                <div id="stat-limit">0</div>
            </div>
            <div class="stat-item">
                <small>Remaining</small>
                <div id="stat-remaining">0</div>
            </div>
        </div>

        <div class="card" style="text-align: center;">
            <button id="btn-earn" class="btn btn-primary" onclick="handleEarnClick()">
                üöÄ Earn Coins
            </button>
            <div id="timer-display" class="hidden">Wait: <span id="seconds">0</span>s</div>
            <p style="font-size: 0.75rem; margin-top: 10px; color: #94a3b8;">Click the button to open the ad and wait for the timer.</p>
        </div>
    </div>

    <div id="view-withdraw" class="view hidden">
        <h2>Withdraw Funds</h2>
        <div class="card">
            <p>Available Balance: <b id="withdraw-balance">0</b> Coins</p>
            <p style="font-size: 0.8rem; color: var(--warning-color)">Min. Withdraw: <span id="min-wd-text">0</span> Coins</p>
            
            <label>Payment Method</label>
            <select id="wd-method">
                <option value="Bkash">Bkash</option>
                <option value="Nagad">Nagad</option>
                <option value="Payeer">Payeer</option>
                <option value="USDT">USDT (TRC20)</option>
            </select>
            
            <label>Account Number / Wallet Address</label>
            <input type="text" id="wd-account" placeholder="Enter details">
            
            <label>Amount (Coins)</label>
            <input type="number" id="wd-amount" placeholder="Min. 100">
            
            <button class="btn btn-withdraw" onclick="submitWithdraw()">Submit Request</button>
        </div>
    </div>

    <div id="view-referral" class="view hidden">
        <h2>Refer & Earn</h2>
        <div class="card">
            <p>Invite friends and get <b id="ref-bonus-text">0</b> coins per referral!</p>
            <div style="margin: 15px 0;">
                <input type="text" id="ref-link" readonly>
                <button class="btn btn-secondary" onclick="copyRef()">Copy Link</button>
            </div>
            <p>Total Referrals: <span id="total-refs">0</span></p>
        </div>
    </div>

    <div id="view-history" class="view hidden">
        <h2>Activity History</h2>
        <div id="history-list">
            </div>
    </div>

    <div id="view-admin-login" class="view hidden">
        <div class="card">
            <h3>Admin Access</h3>
            <input type="password" id="admin-pass" placeholder="Enter Admin Password">
            <button class="btn btn-primary" onclick="checkAdminPass()">Login</button>
            <button class="btn" style="margin-top: 10px; background: none;" onclick="showView('home')">Back</button>
        </div>
    </div>

    <div id="view-admin-panel" class="view hidden">
        <div class="admin-header">ADMIN CONTROL PANEL</div>
        
        <div class="card grid-stats">
            <div class="stat-item">Users: <span id="adm-total-users">0</span></div>
            <div class="stat-item">Clicks: <span id="adm-total-clicks">0</span></div>
        </div>

        <div class="card">
            <h4>Settings</h4>
            <label>Monetag Smartlink</label>
            <input type="text" id="adm-monetag-url">
            
            <div class="grid-stats">
                <div>
                    <label>Daily Limit</label>
                    <input type="number" id="adm-daily-limit">
                </div>
                <div>
                    <label>Cooldown (sec)</label>
                    <input type="number" id="adm-cooldown">
                </div>
            </div>
            
            <div class="grid-stats">
                <div>
                    <label>Coin/Ad</label>
                    <input type="number" id="adm-coin-per-ad">
                </div>
                <div>
                    <label>Min Withdraw</label>
                    <input type="number" id="adm-min-wd">
                </div>
            </div>
            <button class="btn btn-primary" onclick="saveAdminSettings()">Save All Settings</button>
        </div>

        <div class="card">
            <h4>Withdraw Requests</h4>
            <div id="adm-withdraw-list"></div>
        </div>

        <button class="btn btn-secondary" onclick="logoutAdmin()">Logout</button>
    </div>
</div>

<nav class="nav-bar" id="bottom-nav">
    <button class="nav-item active" onclick="showView('home')">üè†<br>Home</button>
    <button class="nav-item" onclick="showView('referral')">üë•<br>Refer</button>
    <button class="nav-item" onclick="showView('withdraw')">üí∞<br>Withdraw</button>
    <button class="nav-item" onclick="showView('history')">üìú<br>History</button>
</nav>

<script>
    /* --- DATA MANAGEMENT --- */
    let db = JSON.parse(localStorage.getItem('adsEarnDB')) || {
        settings: {
            adminPass: "SHG_YT", // Updated Password
            monetagUrl: "https://www.google.com", 
            dailyLimit: 25,
            cooldown: 30,
            coinPerAd: 1,
            minWithdraw: 100,
            refBonus: 5
        },
        users: {}, 
        withdraws: [],
        globalStats: { clicks: 0 }
    };

    function saveData() {
        localStorage.setItem('adsEarnDB', JSON.stringify(db));
    }

    /* --- TELEGRAM INTEGRATION --- */
    const tg = window.Telegram.WebApp;
    tg.expand();
    const user = tg.initDataUnsafe?.user || { id: "12345", first_name: "Demo User" };

    if (!db.users[user.id]) {
        db.users[user.id] = {
            id: user.id,
            name: user.first_name,
            coins: 0,
            clicksToday: 0,
            lastReset: new Date().toDateString(),
            referrals: 0,
            history: [],
            isBanned: false
        };
        saveData();
    }

    let currentUser = db.users[user.id];

    if (currentUser.lastReset !== new Date().toDateString()) {
        currentUser.clicksToday = 0;
        currentUser.lastReset = new Date().toDateString();
        saveData();
    }

    /* --- UI CONTROLLER --- */
    function showView(viewId) {
        document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
        document.getElementById('view-' + viewId).classList.remove('hidden');
        
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        if (['home','referral','withdraw','history'].includes(viewId)) {
            const index = ['home','referral','withdraw','history'].indexOf(viewId);
            document.querySelectorAll('.nav-item')[index].classList.add('active');
        }

        if (viewId === 'home') updateDashboard();
        if (viewId === 'withdraw') updateWithdrawView();
        if (viewId === 'referral') updateReferralView();
        if (viewId === 'history') updateHistoryView();
        if (viewId === 'admin-panel') loadAdminDashboard();
    }

    function updateDashboard() {
        if(currentUser.isBanned) {
            document.body.innerHTML = "<h1 style='padding:50px; text-align:center;'>You are banned.</h1>";
            return;
        }
        document.getElementById('user-name').innerText = currentUser.name;
        document.getElementById('user-coins').innerText = currentUser.coins;
        document.getElementById('stat-limit').innerText = db.settings.dailyLimit;
        document.getElementById('stat-remaining').innerText = db.settings.dailyLimit - currentUser.clicksToday;
    }

    function updateWithdrawView() {
        document.getElementById('withdraw-balance').innerText = currentUser.coins;
        document.getElementById('min-wd-text').innerText = db.settings.minWithdraw;
    }

    function updateReferralView() {
        document.getElementById('ref-bonus-text').innerText = db.settings.refBonus;
        document.getElementById('total-refs').innerText = currentUser.referrals;
        document.getElementById('ref-link').value = `https://t.me/AdsEarnBot?start=${user.id}`;
    }

    function updateHistoryView() {
        const container = document.getElementById('history-list');
        container.innerHTML = '<h4>Activity History</h4>';
        db.withdraws.filter(w => w.userId === user.id).forEach(w => {
            container.innerHTML += `
                <div class="list-item">
                    <b>${w.amount} Coins via ${w.method}</b><br>
                    <small>${w.date}</small>
                    <span class="badge badge-${w.status.toLowerCase()}" style="float:right">${w.status}</span>
                </div>`;
        });
    }

    /* --- ADS SYSTEM --- */
    let timerInterval;
    function handleEarnClick() {
        if (currentUser.clicksToday >= db.settings.dailyLimit) {
            alert("Daily limit reached!");
            return;
        }

        window.open(db.settings.monetagUrl, '_blank');

        const btn = document.getElementById('btn-earn');
        const timerDisp = document.getElementById('timer-display');
        const secSpan = document.getElementById('seconds');
        
        btn.disabled = true;
        timerDisp.classList.remove('hidden');
        
        let timeLeft = db.settings.cooldown;
        secSpan.innerText = timeLeft;

        timerInterval = setInterval(() => {
            timeLeft--;
            secSpan.innerText = timeLeft;

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                currentUser.coins += db.settings.coinPerAd;
                currentUser.clicksToday += 1;
                db.globalStats.clicks += 1;
                
                currentUser.history.push({
                    type: 'Click',
                    amount: db.settings.coinPerAd,
                    date: new Date().toLocaleString()
                });

                saveData();
                updateDashboard();
                
                btn.disabled = false;
                timerDisp.classList.add('hidden');
                alert(`Success! +${db.settings.coinPerAd} coin added.`);
            }
        }, 1000);
    }

    /* --- WITHDRAW LOGIC --- */
    function submitWithdraw() {
        const amount = parseInt(document.getElementById('wd-amount').value);
        const method = document.getElementById('wd-method').value;
        const account = document.getElementById('wd-account').value;

        if (amount < db.settings.minWithdraw) {
            alert(`Minimum withdraw is ${db.settings.minWithdraw} coins`);
            return;
        }
        if (amount > currentUser.coins) {
            alert("Insufficient balance!");
            return;
        }
        if (!account) {
            alert("Please enter payment account details");
            return;
        }

        currentUser.coins -= amount;
        const request = {
            id: Date.now(),
            userId: user.id,
            userName: currentUser.name,
            amount: amount,
            method: method,
            account: account,
            status: 'Pending',
            date: new Date().toLocaleDateString()
        };

        db.withdraws.push(request);
        saveData();
        updateWithdrawView();
        alert("Withdrawal request submitted!");
    }

    /* --- ADMIN LOGIC --- */
    function showAdminLogin() { showView('admin-login'); }

    function checkAdminPass() {
        const pass = document.getElementById('admin-pass').value;
        if (pass === db.settings.adminPass) {
            showView('admin-panel');
        } else {
            alert("Wrong password!");
        }
    }

    function loadAdminDashboard() {
        document.getElementById('adm-total-users').innerText = Object.keys(db.users).length;
        document.getElementById('adm-total-clicks').innerText = db.globalStats.clicks;
        
        document.getElementById('adm-monetag-url').value = db.settings.monetagUrl;
        document.getElementById('adm-daily-limit').value = db.settings.dailyLimit;
        document.getElementById('adm-cooldown').value = db.settings.cooldown;
        document.getElementById('adm-coin-per-ad').value = db.settings.coinPerAd;
        document.getElementById('adm-min-wd').value = db.settings.minWithdraw;

        const list = document.getElementById('adm-withdraw-list');
        list.innerHTML = "";
        db.withdraws.forEach((w, index) => {
            if(w.status === 'Pending') {
                list.innerHTML += `
                <div class="list-item">
                    <b>${w.userName}</b> - ${w.amount} Coins<br>
                    <small>${w.method}: ${w.account}</small><br>
                    <button onclick="manageWithdraw(${index}, 'Approved')" style="color:green">Approve</button> | 
                    <button onclick="manageWithdraw(${index}, 'Rejected')" style="color:red">Reject</button>
                </div>`;
            }
        });
    }

    function saveAdminSettings() {
        db.settings.monetagUrl = document.getElementById('adm-monetag-url').value;
        db.settings.dailyLimit = parseInt(document.getElementById('adm-daily-limit').value);
        db.settings.cooldown = parseInt(document.getElementById('adm-cooldown').value);
        db.settings.coinPerAd = parseInt(document.getElementById('adm-coin-per-ad').value);
        db.settings.minWithdraw = parseInt(document.getElementById('adm-min-wd').value);
        saveData();
        alert("Settings Saved!");
    }

    function manageWithdraw(index, status) {
        db.withdraws[index].status = status;
        if(status === 'Rejected') {
            const uid = db.withdraws[index].userId;
            db.users[uid].coins += db.withdraws[index].amount;
        }
        saveData();
        loadAdminDashboard();
    }

    function logoutAdmin() { showView('home'); }

    function copyRef() {
        const link = document.getElementById('ref-link');
        link.select();
        document.execCommand('copy');
        alert("Referral link copied!");
    }

    // Initialize
    updateDashboard();
</script>

</body>
</html>